<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title></title>
	<meta name="generator" content="LibreOffice 24.8.1.2 (Linux)"/>
	<meta name="created" content="00:00:00"/>
	<meta name="changed" content="00:00:00"/>
	<style type="text/css">
		@page { size: 8.27in 11.69in; margin: 0.79in }
		p { line-height: 115%; margin-bottom: 0.1in; background: transparent }
		pre { background: transparent }
		pre.western { font-family: "Liberation Mono", monospace; font-size: 10pt }
		pre.cjk { font-family: "NSimSun", monospace; font-size: 10pt }
		pre.ctl { font-family: "Liberation Mono", monospace; font-size: 10pt }
	</style>
</head>
<body lang="en-US" link="#000080" vlink="#800000" dir="ltr"><pre class="western">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;es&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;SECOP Cloud - Control de Supervisi√≥n&lt;/title&gt;
    &lt;!-- Tailwind CSS para el dise√±o --&gt;
    &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;
    &lt;!-- React y ReactDOM --&gt;
    &lt;script src=&quot;https://unpkg.com/react@18/umd/react.production.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://unpkg.com/react-dom@18/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;
    &lt;!-- Babel para JSX --&gt;
    &lt;script src=&quot;https://unpkg.com/@babel/standalone/babel.min.js&quot;&gt;&lt;/script&gt;
    
    &lt;!-- Firebase SDK (Versiones Compat) --&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js&quot;&gt;&lt;/script&gt;

    &lt;!-- Lucide Icons --&gt;
    &lt;script src=&quot;https://unpkg.com/lucide@latest&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&amp;display=swap');
        body { font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body class=&quot;bg-slate-50&quot;&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;

    &lt;script type=&quot;text/babel&quot;&gt;
        // --- CONFIGURACI√ìN DE FIREBASE ---
        const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
        const appId = window.__app_id || 'secop-bolivar-v1';
        
        // Inicializaci√≥n √∫nica
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();

        const { useState, useEffect, useMemo } = React;

        // Componente de Iconos corregido para CDN
        const Icon = ({ name, className }) =&gt; {
            const ref = React.useRef(null);
            useEffect(() =&gt; {
                if (window.lucide &amp;&amp; ref.current) {
                    ref.current.innerHTML = ''; // Limpiar previo
                    const iconEl = document.createElement('i');
                    iconEl.setAttribute('data-lucide', name.toLowerCase().replace(/([a-z0-9])([A-Z])/g, '$1-$2'));
                    if (className) iconEl.className = className;
                    ref.current.appendChild(iconEl);
                    window.lucide.createIcons();
                }
            }, [name, className]);
            return &lt;span ref={ref} className=&quot;inline-flex items-center justify-center&quot; /&gt;;
        };

        const MONTHS = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        const ACCESS_CONFIG = { supervisor: &quot;sup123&quot;, financiera: &quot;fin456&quot; };

        function App() {
            const [user, setUser] = useState(null);
            const [role, setRole] = useState(null);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginForm, setLoginForm] = useState({ role: 'supervisor', password: '' });
            const [loginError, setLoginError] = useState('');
            const [loading, setLoading] = useState(false);

            const [masterInstructors, setMasterInstructors] = useState([]);
            const [supervisionData, setSupervisionData] = useState({});
            const [view, setView] = useState('dashboard');
            const [selectedMonth, setSelectedMonth] = useState(MONTHS[new Date().getMonth()]);
            const [filterText, setFilterText] = useState('');
            const [activeTab, setActiveTab] = useState('all');

            // 1. Manejo de Autenticaci√≥n (Regla 3: Auth antes de Queries)
            useEffect(() =&gt; {
                const initAuth = async () =&gt; {
                    try {
                        if (typeof window.__initial_auth_token !== 'undefined' &amp;&amp; window.__initial_auth_token) {
                            await auth.signInWithCustomToken(window.__initial_auth_token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (err) {
                        console.error(&quot;Error en Autenticaci√≥n:&quot;, err);
                    }
                };

                initAuth();
                const unsubscribe = auth.onAuthStateChanged((u) =&gt; {
                    setUser(u);
                });
                return () =&gt; unsubscribe();
            }, []);

            // 2. Carga de datos (Solo si hay usuario autenticado Y login en UI)
            useEffect(() =&gt; {
                if (!user || !isLoggedIn) return;
                
                setLoading(true);
                
                // Ruta p√∫blica seg√∫n Regla 1
                const baseRef = db.collection('artifacts').doc(appId).collection('public').doc('data');
                
                // Listener de Instructores
                const unsubInst = baseRef.collection('instructors').onSnapshot((snap) =&gt; {
                    setMasterInstructors(snap.docs.map(d =&gt; ({ id: d.id, ...d.data() })));
                    setLoading(false);
                }, (err) =&gt; {
                    console.error(&quot;Error permisos instructores:&quot;, err);
                    setLoading(false);
                });

                // Listener de Supervisi√≥n
                const unsubSup = baseRef.collection('supervision').onSnapshot((snap) =&gt; {
                    const data = {};
                    snap.docs.forEach(d =&gt; { data[d.id] = d.data(); });
                    setSupervisionData(data);
                }, (err) =&gt; {
                    console.error(&quot;Error permisos supervisi√≥n:&quot;, err);
                });

                return () =&gt; { 
                    unsubInst(); 
                    unsubSup(); 
                };
            }, [user, isLoggedIn]);

            const handleLogin = (e) =&gt; {
                e.preventDefault();
                if (ACCESS_CONFIG[loginForm.role] === loginForm.password) {
                    setRole(loginForm.role);
                    setIsLoggedIn(true);
                    setLoginError('');
                } else {
                    setLoginError('Contrase√±a incorrecta');
                }
            };

            const instructorsList = useMemo(() =&gt; {
                return masterInstructors.map(m =&gt; {
                    const key = `${selectedMonth}-${m.cc}`;
                    return { ...m, ...(supervisionData[key] || { gcStatus: 'pending', gfStatus: 'pending', hours: 0 }) };
                }).filter(i =&gt; 
                    i.name.toLowerCase().includes(filterText.toLowerCase()) || 
                    i.cc.includes(filterText)
                );
            }, [masterInstructors, supervisionData, selectedMonth, filterText]);

            const updateStatus = async (cc, field, value) =&gt; {
                if (!user) return;
                const key = `${selectedMonth}-${cc}`;
                const docRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('supervision').doc(key);
                
                const current = supervisionData[key] || { gcStatus: 'pending', gfStatus: 'pending', hours: 0 };
                try {
                    await docRef.set({
                        ...current,
                        [field]: value,
                        lastModified: Date.now()
                    }, { merge: true });
                } catch (err) {
                    console.error(&quot;Error al guardar:&quot;, err);
                }
            };

            if (!isLoggedIn) {
                return (
                    &lt;div className=&quot;h-screen flex items-center justify-center bg-slate-900 px-4&quot;&gt;
                        &lt;div className=&quot;bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md&quot;&gt;
                            &lt;div className=&quot;text-center mb-6&quot;&gt;
                                &lt;div className=&quot;bg-orange-600 w-12 h-12 rounded-xl flex items-center justify-center mx-auto mb-4 text-white font-black text-xl shadow-lg shadow-orange-900/20&quot;&gt;S&lt;/div&gt;
                                &lt;h2 className=&quot;text-2xl font-black uppercase tracking-tight&quot;&gt;Acceso SECOP&lt;/h2&gt;
                                &lt;p className=&quot;text-[10px] text-slate-400 font-bold uppercase mt-1 tracking-widest&quot;&gt;Regional Bol√≠var&lt;/p&gt;
                            &lt;/div&gt;
                            &lt;form onSubmit={handleLogin} className=&quot;space-y-4&quot;&gt;
                                &lt;div className=&quot;grid grid-cols-2 gap-2&quot;&gt;
                                    {['supervisor', 'financiera'].map(r =&gt; (
                                        &lt;button 
                                            key={r} 
                                            type=&quot;button&quot; 
                                            onClick={() =&gt; setLoginForm({...loginForm, role: r})} 
                                            className={`py-3 rounded-xl text-[10px] font-black uppercase transition-all ${loginForm.role === r ? 'bg-orange-600 text-white shadow-lg shadow-orange-200' : 'bg-slate-100 text-slate-400 hover:bg-slate-200'}`}
                                        &gt;
                                            {r}
                                        &lt;/button&gt;
                                    ))}
                                &lt;/div&gt;
                                &lt;div className=&quot;space-y-1&quot;&gt;
                                    &lt;label className=&quot;text-[9px] font-black text-slate-400 uppercase ml-1&quot;&gt;Contrase√±a de acceso&lt;/label&gt;
                                    &lt;input 
                                        type=&quot;password&quot; 
                                        placeholder=&quot;‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢&quot; 
                                        className=&quot;w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-orange-500 transition-all&quot; 
                                        value={loginForm.password} 
                                        onChange={e =&gt; setLoginForm({...loginForm, password: e.target.value})} 
                                    /&gt;
                                &lt;/div&gt;
                                {loginError &amp;&amp; &lt;p className=&quot;text-red-500 text-[10px] font-black uppercase text-center&quot;&gt;{loginError}&lt;/p&gt;}
                                &lt;button type=&quot;submit&quot; className=&quot;w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs hover:bg-black transition-all shadow-xl&quot;&gt;Entrar al Sistema&lt;/button&gt;
                            &lt;/form&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                );
            }

            return (
                &lt;div className=&quot;min-h-screen&quot;&gt;
                    &lt;header className=&quot;bg-white border-b sticky top-0 z-40 p-4 shadow-sm&quot;&gt;
                        &lt;div className=&quot;max-w-7xl mx-auto flex justify-between items-center&quot;&gt;
                            &lt;div className=&quot;flex items-center space-x-3&quot;&gt;
                                &lt;div className=&quot;bg-orange-600 p-2 rounded-lg text-white font-black text-xs&quot;&gt;S&lt;/div&gt;
                                &lt;div&gt;
                                    &lt;span className=&quot;font-black text-sm uppercase block leading-none&quot;&gt;SECOP Cloud&lt;/span&gt;
                                    &lt;span className=&quot;text-[9px] font-black text-blue-600 uppercase tracking-tighter&quot;&gt;Sesi√≥n: {role}&lt;/span&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div className=&quot;flex gap-2&quot;&gt;
                                &lt;button 
                                    onClick={() =&gt; setView(view === 'dashboard' ? 'master' : 'dashboard')} 
                                    className={`px-4 py-2 rounded-lg text-[10px] font-black uppercase transition-all ${view === 'dashboard' ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-600'}`}
                                &gt;
                                    {view === 'dashboard' ? 'Base Maestra' : 'Tablero Control'}
                                &lt;/button&gt;
                                &lt;button onClick={() =&gt; setIsLoggedIn(false)} className=&quot;p-2 text-slate-300 hover:text-red-500 transition-colors flex items-center justify-center&quot;&gt;
                                    &lt;Icon name=&quot;LogOut&quot; className=&quot;w-5 h-5&quot; /&gt;
                                &lt;/button&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/header&gt;

                    &lt;main className=&quot;max-w-7xl mx-auto p-4 md:p-6&quot;&gt;
                        {loading &amp;&amp; (
                            &lt;div className=&quot;flex items-center justify-center p-12 text-[10px] font-black uppercase tracking-widest text-slate-400&quot;&gt;
                                Cargando datos de la nube...
                            &lt;/div&gt;
                        )}
                        
                        {!loading &amp;&amp; view === 'dashboard' ? (
                            &lt;&gt;
                                &lt;div className=&quot;flex space-x-1 mb-6 overflow-x-auto pb-2 no-scrollbar&quot;&gt;
                                    {MONTHS.map(m =&gt; (
                                        &lt;button 
                                            key={m} 
                                            onClick={() =&gt; setSelectedMonth(m)} 
                                            className={`px-4 py-2 rounded-lg text-[9px] font-black uppercase whitespace-nowrap transition-all ${selectedMonth === m ? 'bg-orange-600 text-white shadow-lg shadow-orange-100' : 'bg-white text-slate-400 border border-slate-200 hover:bg-slate-50'}`}
                                        &gt;
                                            {m}
                                        &lt;/button&gt;
                                    ))}
                                &lt;/div&gt;
                                
                                &lt;div className=&quot;bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden&quot;&gt;
                                    &lt;div className=&quot;p-4 border-b border-slate-100 flex flex-wrap gap-4 items-center justify-between bg-slate-50/30&quot;&gt;
                                        &lt;input 
                                            type=&quot;text&quot; 
                                            placeholder=&quot;Buscar por nombre o CC...&quot; 
                                            className=&quot;pl-4 pr-4 py-2 border border-slate-200 rounded-xl text-xs w-64 outline-none focus:ring-2 focus:ring-orange-500&quot; 
                                            value={filterText} 
                                            onChange={e =&gt; setFilterText(e.target.value)} 
                                        /&gt;
                                        &lt;div className=&quot;flex bg-slate-100 p-1 rounded-lg&quot;&gt;
                                            {['all', 'gc', 'gf'].map(t =&gt; (
                                                &lt;button 
                                                    key={t} 
                                                    onClick={() =&gt; setActiveTab(t)} 
                                                    className={`px-4 py-1.5 text-[9px] font-black uppercase rounded-md transition-all ${activeTab === t ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400 hover:text-slate-600'}`}
                                                &gt;
                                                    {t === 'all' ? 'Ver Todos' : t === 'gc' ? 'Supervisor' : 'Financiera'}
                                                &lt;/button&gt;
                                            ))}
                                        &lt;/div&gt;
                                    &lt;/div&gt;

                                    &lt;div className=&quot;overflow-x-auto&quot;&gt;
                                        &lt;table className=&quot;w-full text-left&quot;&gt;
                                            &lt;thead className=&quot;bg-slate-50 text-[10px] font-black uppercase text-slate-400&quot;&gt;
                                                &lt;tr&gt;
                                                    &lt;th className=&quot;p-4 border-b border-slate-100&quot;&gt;Instructor&lt;/th&gt;
                                                    &lt;th className=&quot;p-4 border-b border-slate-100 text-center&quot;&gt;Horas&lt;/th&gt;
                                                    {(activeTab === 'all' || activeTab === 'gc') &amp;&amp; &lt;th className=&quot;p-4 border-b border-slate-100&quot;&gt;Estado Supervisor&lt;/th&gt;}
                                                    {(activeTab === 'all' || activeTab === 'gf') &amp;&amp; &lt;th className=&quot;p-4 border-b border-slate-100&quot;&gt;Estado Financiera&lt;/th&gt;}
                                                &lt;/tr&gt;
                                            &lt;/thead&gt;
                                            &lt;tbody className=&quot;divide-y divide-slate-100&quot;&gt;
                                                {instructorsList.length &gt; 0 ? instructorsList.map(i =&gt; (
                                                    &lt;tr key={i.id} className=&quot;text-xs hover:bg-slate-50/50 transition-colors&quot;&gt;
                                                        &lt;td className=&quot;p-4&quot;&gt;
                                                            &lt;div className=&quot;font-bold text-slate-900&quot;&gt;{i.name}&lt;/div&gt;
                                                            &lt;div className=&quot;text-[10px] text-slate-400 font-mono mt-0.5&quot;&gt;CC {i.cc}&lt;/div&gt;
                                                        &lt;/td&gt;
                                                        &lt;td className=&quot;p-4 text-center&quot;&gt;
                                                            &lt;span className={`px-2.5 py-1 rounded-md font-black text-[10px] ${i.hours &gt;= 160 ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'}`}&gt;
                                                                {i.hours}h
                                                            &lt;/span&gt;
                                                        &lt;/td&gt;
                                                        {(activeTab === 'all' || activeTab === 'gc') &amp;&amp; (
                                                            &lt;td className=&quot;p-4&quot;&gt;
                                                                &lt;select 
                                                                    disabled={role !== 'supervisor'} 
                                                                    value={i.gcStatus} 
                                                                    onChange={e =&gt; updateStatus(i.cc, 'gcStatus', e.target.value)} 
                                                                    className={`w-full p-2.5 rounded-lg font-black text-[10px] uppercase border transition-all outline-none ${i.gcStatus === 'verified' ? 'bg-blue-600 text-white border-blue-700' : i.gcStatus === 'rejected' ? 'bg-red-500 text-white border-red-600' : 'bg-white border-slate-200 text-slate-400'}`}
                                                                &gt;
                                                                    &lt;option value=&quot;pending&quot;&gt;üü° Pendiente&lt;/option&gt;
                                                                    &lt;option value=&quot;verified&quot;&gt;‚úÖ Aprobado&lt;/option&gt;
                                                                    &lt;option value=&quot;rejected&quot;&gt;‚ùå Rechazado&lt;/option&gt;
                                                                &lt;/select&gt;
                                                            &lt;/td&gt;
                                                        )}
                                                        {(activeTab === 'all' || activeTab === 'gf') &amp;&amp; (
                                                            &lt;td className=&quot;p-4&quot;&gt;
                                                                &lt;select 
                                                                    disabled={role !== 'financiera'} 
                                                                    value={i.gfStatus} 
                                                                    onChange={e =&gt; updateStatus(i.cc, 'gfStatus', e.target.value)} 
                                                                    className={`w-full p-2.5 rounded-lg font-black text-[10px] uppercase border transition-all outline-none ${i.gfStatus === 'verified' ? 'bg-purple-600 text-white border-purple-700' : i.gfStatus === 'rejected' ? 'bg-red-500 text-white border-red-600' : 'bg-white border-slate-200 text-slate-400'}`}
                                                                &gt;
                                                                    &lt;option value=&quot;pending&quot;&gt;üü° Pendiente&lt;/option&gt;
                                                                    &lt;option value=&quot;verified&quot;&gt;‚úÖ Aprobado&lt;/option&gt;
                                                                    &lt;option value=&quot;rejected&quot;&gt;‚ùå Rechazado&lt;/option&gt;
                                                                &lt;/select&gt;
                                                            &lt;/td&gt;
                                                        )}
                                                    &lt;/tr&gt;
                                                )) : (
                                                    &lt;tr&gt;
                                                        &lt;td colSpan=&quot;4&quot; className=&quot;p-12 text-center text-slate-400 font-bold uppercase text-[10px] tracking-widest italic&quot;&gt;
                                                            No se encontraron instructores
                                                        &lt;/td&gt;
                                                    &lt;/tr&gt;
                                                )}
                                            &lt;/tbody&gt;
                                        &lt;/table&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/&gt;
                        ) : !loading &amp;&amp; (
                            &lt;div className=&quot;bg-white rounded-2xl border border-slate-200 p-6 shadow-sm&quot;&gt;
                                &lt;div className=&quot;flex justify-between items-center mb-6&quot;&gt;
                                    &lt;h2 className=&quot;font-black text-xl uppercase tracking-tight&quot;&gt;Base Maestra de Instructores&lt;/h2&gt;
                                &lt;/div&gt;
                                &lt;div className=&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4&quot;&gt;
                                    {masterInstructors.map(i =&gt; (
                                        &lt;div key={i.id} className=&quot;p-4 border border-slate-100 rounded-2xl hover:border-orange-200 transition-all bg-slate-50/50&quot;&gt;
                                            &lt;div className=&quot;font-black text-sm text-slate-900&quot;&gt;{i.name}&lt;/div&gt;
                                            &lt;div className=&quot;flex justify-between items-center mt-2&quot;&gt;
                                                &lt;span className=&quot;text-[10px] font-mono text-slate-400&quot;&gt;CC {i.cc}&lt;/span&gt;
                                                &lt;span className=&quot;text-[10px] font-black text-blue-600 uppercase bg-blue-50 px-2 py-0.5 rounded-md&quot;&gt;{i.contract}&lt;/span&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                    ))}
                                &lt;/div&gt;
                            &lt;/div&gt;
                        )}
                    &lt;/main&gt;
                &lt;/div&gt;
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(&lt;App /&gt;);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</body>
</html>